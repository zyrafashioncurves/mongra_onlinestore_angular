<p-fluid class="flex flex-wrap items-center justify-between gap-4">
    <div class="card flex flex-wrap items-center justify-between w-full">
        <div class="flex-1 min-w-[150px]">
            <h4 class="font-bold">Add New Variant</h4>
        </div>

        <div class="flex justify-end">
            <p-button pTooltip="Add Variant" tooltipPosition="left" label="Save Variant" icon="pi pi-save" raised
                type="button" (click)="onSubmit(formRef)" severity="warn" size="large">
            </p-button>

            <!-- Confirmation Dialog -->
            <p-dialog header="Confirmation" [(visible)]="displayConfirmation" [style]="{ width: '350px' }"
                [modal]="true">
                <div class="flex items-center justify-center">
                    <i class="pi pi-info-circle mr-4" style="font-size: 3rem"> </i>
                    <span>Are you sure you want to save this product?</span>
                </div>
                <ng-template #footer>
                    <p-button label="No" icon="pi pi-times" (click)="closeConfirmation()" text severity="secondary"
                        raised />
                    <p-button label="Yes" icon="pi pi-check" (click)="saveProduct()" severity="warn" raised autofocus />
                </ng-template>
            </p-dialog>
        </div>
    </div>
</p-fluid>
<form #formRef="ngForm" id="productForm" (ngSubmit)="onSubmit(formRef)" novalidate>
    <!-- Product Details -->
    <p-fluid class="flex mt-5">
        <div class="card flex flex-col gap-6 w-full">
            <div class="font-semibold text-xl">Select the product under which you want to add the variant by choosing
                below
                @if(showeErrorSuggestion){<span class="p-error text-red-800 ">(NOTE : All fields are mandatory to be
                    filled)</span>}
            </div>

            <div class="flex flex-wrap w-full">
                <!-- Name -->
                <div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
                    <p-floatlabel variant="on">
                        <p-autocomplete id="name" name="productName" optionLabel="productName"
                            [(ngModel)]="product.name" #name="ngModel" [suggestions]="autoFilteredProductName"
                            [dropdown]="true" (completeMethod)="filterProductName($event)" required class="w-full">
                        </p-autocomplete>
                        <label for="name">Product Name</label>
                    </p-floatlabel>

                    @if (name.invalid && name.touched) {
                    <small class="p-error text-red-800">Product name is required</small>
                    }
                </div>

                <!-- Category -->
                <div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
                    <p-floatlabel variant="on">
                        <p-autocomplete [(ngModel)]="product.category" name="category" #category="ngModel" required
                            [suggestions]="autoFilteredCategoryValue" optionLabel="category" field="category" dropdown
                            (completeMethod)="filterCategory($event)" (onSelect)="onCategorySelect($event)"
                            inputId="category" class="w-full">
                        </p-autocomplete>
                        <label for="Category">Category</label>
                    </p-floatlabel>
                    @if(category.invalid && category.touched){<small class="p-error text-red-800">Product category is
                        required</small>}
                </div>

                <!-- Gender -->
                <div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
                    <p-floatlabel variant="on">
                        <p-autocomplete [(ngModel)]="product.genderCategory" name="genderCategory"
                            #genderCategory="ngModel" required [suggestions]="autoFilteredGenderCategoryValue"
                            optionLabel="genderCategory" field="genderCategory" dropdown
                            (completeMethod)="filterGenderCategory($event)" (onSelect)="onGenderCategorySelect($event)"
                            [disabled]="!hasGenderCategory" inputId="genderCategory" class="w-full">
                        </p-autocomplete>
                        <label for="genderCategory">Gender Category</label>
                    </p-floatlabel>
                    @if(genderCategory.invalid && genderCategory.touched){<small class="p-error text-red-800">Product
                        gender
                        category is required</small>}
                </div>

                <!-- Sub Category -->
                <div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
                    <p-floatlabel variant="on">
                        <p-autocomplete [(ngModel)]="product.subCategory" name="subcategory" #subCategory="ngModel"
                            required [suggestions]="autoFilteredSubCategoryValue" optionLabel="subCategory"
                            field="subCategory" dropdown (completeMethod)="filterSubCategory($event)"
                            [disabled]="!hasSubCategory" inputId="subCategory" class="w-full">
                        </p-autocomplete>
                        <label for="subCategory">Sub Category</label>
                    </p-floatlabel>
                    @if(subCategory.invalid && subCategory.touched){<small class="p-error text-red-800">Product sub
                        category is
                        required</small>}
                </div>
            </div>
            <div class="w-full px-2 mb-4">
                <div class="flex justify-end">
                    <p-button label="Check Parent Product" icon="pi pi-search" (click)="checkParentProduct()"
                        severity="info" outlined size="small"
                        pTooltip="Verify if a product exists with the selected details" tooltipPosition="top">
                    </p-button>
                </div>
            </div>
        </div>
    </p-fluid>
</form>
<!-- Sizes Table -->
@if(productFound){
<p-fluid class="flex flex-col gap-8 mt-5">
    <div class="w-full">
        <div class="card flex flex-col gap-4">

            <!-- Header Row -->
            <div class="flex justify-between items-center">
                <div class="font-semibold text-xl">Add Variant Details</div>
                @if(showeErrorSuggestionSize){
                <span class="p-error text-red-800 text-sm">
                    (NOTE: All fields are mandatory to be filled)
                </span>
                }
            </div>

            <!-- Color Selector & Add Size Section -->
            <div class="flex flex-wrap">
                <div class="w-full sm:w-1/2 lg:w-1/4 px-2">
                    <p-floatlabel variant="on">
                        <p-autocomplete [(ngModel)]="variant.color" name="color" #color="ngModel" required
                            [suggestions]="autoFilteredValue" optionLabel="name" field="name" dropdown
                            (completeMethod)="filterItem($event)" inputId="variantColor" class="w-full">
                        </p-autocomplete>
                        <label for="variantColor">Color</label>
                    </p-floatlabel>
                    @if(color.invalid && color.touched){
                    <small class="p-error text-red-800">Product color is required</small>
                    }
                </div>
                 
                <div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
          <p-floatlabel variant="on">
            <input pInputText id="variantname" name="variantName" type="text" [(ngModel)]="variant.variantName" #variantName="ngModel"
              required class="w-full" />
            <label for="variantname">Variant Name</label>
          </p-floatlabel>
          @if(variantName.invalid && variantName.touched){<small class="p-error text-red-800">Variant name is required</small>}
        </div>

        <!-- Style Category -->
        <div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
          <p-floatlabel variant="on">
            <p-autocomplete [(ngModel)]="variant.styleCategory" name="styleCategory" #styleCategory="ngModel" required
              [suggestions]="autoFilteredStyleCategoryValue" optionLabel="styleCategory" field="styleCategory" dropdown
              (completeMethod)="filterStyleCategory($event)" inputId="styleCategory"
              class="w-full">
            </p-autocomplete>
            <label for="styleCategory">Style Category</label>
          </p-floatlabel>
          @if(styleCategory.invalid && styleCategory.touched){<small class="p-error text-red-800">Style category is
            required</small>}
        </div>

        <!-- fit -->
        <div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
          <p-floatlabel variant="on">
            <p-autocomplete [(ngModel)]="variant.fit" name="fit" #fit="ngModel" required
              [suggestions]="autoFilteredFitValue" optionLabel="name" field="fit" dropdown
              (completeMethod)="filterFitItem($event)" inputId="fit" class="w-full">
            </p-autocomplete>
            <label for="fit">Fit</label>
          </p-floatlabel>
          @if(fit.invalid && fit.touched){<small class="p-error text-red-800">fit is required</small>}
        </div>

        <!-- pattern -->
        <div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
          <p-floatlabel variant="on">
            <p-autocomplete [(ngModel)]="variant.pattern" name="pattern" #pattern="ngModel" required
              [suggestions]="autoFilteredPatternValue" optionLabel="name" field="pattern" dropdown
              (completeMethod)="filterPatternItem($event)" inputId="pattern" class="w-full">
            </p-autocomplete>
            <label for="pattern">Pattern</label>
          </p-floatlabel>
          @if(pattern.invalid && pattern.touched){<small class="p-error text-red-800">Pattern is required</small>}
        </div>
<!-- season-->
        <div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
  <p-floatlabel variant="on">
    <p-multiSelect 
      [(ngModel)]="variant.season" 
      name="seasons" 
      #seasons="ngModel"
      [options]="autoFilteredSeasonValue" 
      optionLabel="name" 
      display="chip"
      inputId="season" 
      class="w-full" 
      required>
    </p-multiSelect>
    <label for="season">Season of Wearing</label>
  </p-floatlabel>
  @if(seasons.invalid && seasons.touched){
    <small class="p-error text-red-800">At least one season is required</small>
  }
</div>

        

        <!-- occasion -->
        <div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
  <p-floatlabel variant="on">
    <p-multiSelect 
      [(ngModel)]="variant.occasion" 
      name="occasions" 
      #occasions="ngModel"
      [options]="autoFilteredOccasionValue" 
      optionLabel="name" 
      display="chip"
      inputId="occasion" 
      class="w-full" 
      required>
    </p-multiSelect>
    <label for="occasion">Occasions</label>
  </p-floatlabel>
  @if(occasions.invalid && occasions.touched){
    <small class="p-error text-red-800">At least one occasion is required</small>
  }
</div>

<!-- ============ FABRIC & PRODUCT DETAILS SECTION ============ -->

<!-- Fabric Type -->
<div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
  <p-floatlabel variant="on">
    <input pInputText [(ngModel)]="variant.fabricType" name="fabricType" id="fabricType"
      placeholder="e.g. Cotton, Silk, Georgette" class="w-full" required />
    <label for="fabricType">Fabric Type</label>
  </p-floatlabel>
</div>

<!-- Material Composition -->
<div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
  <p-floatlabel variant="on">
    <input pInputText [(ngModel)]="variant.materialComposition" name="materialComposition"
      id="materialComposition" placeholder="e.g. 80% Cotton, 20% Polyester" class="w-full" required />
    <label for="materialComposition">Material Composition</label>
  </p-floatlabel>
</div>

<!-- Lining Material -->
<div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
  <p-floatlabel variant="on">
    <input pInputText [(ngModel)]="variant.liningMaterial" name="liningMaterial"
      id="liningMaterial" placeholder="e.g. Cotton Lining / No Lining" class="w-full" />
    <label for="liningMaterial">Lining Material</label>
  </p-floatlabel>
</div>

<!-- Transparency Level -->
<div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
  <p-floatlabel variant="on">
    <input pInputText [(ngModel)]="variant.transparencyLevel" name="transparencyLevel"
      id="transparencyLevel" placeholder="e.g. Opaque / Semi Transparent / Transparent" class="w-full" />
    <label for="transparencyLevel">Transparency Level</label>
  </p-floatlabel>
</div>

<!-- Stretchability -->
<div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
  <p-floatlabel variant="on">
    <input pInputText [(ngModel)]="variant.stretchability" name="stretchability"
      id="stretchability" placeholder="e.g. Non-Stretchable / Slight Stretch / High Stretch" class="w-full" />
    <label for="stretchability">Stretchability</label>
  </p-floatlabel>
</div>

<!-- Work Type -->
<div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
  <p-floatlabel variant="on">
    <input pInputText [(ngModel)]="variant.workType" name="workType" id="workType"
      placeholder="e.g. Embroidery, Zari, Mirror Work" class="w-full" />
    <label for="workType">Work Type</label>
  </p-floatlabel>
</div>

<!-- Care Instructions -->
<div class="w-full sm:w-1/2 lg:w-1/2 px-2 mb-4">
  <p-floatlabel variant="on">
    <textarea pInputTextarea [(ngModel)]="variant.careInstructions" name="careInstructions"
      id="careInstructions" rows="2" placeholder="e.g. Hand wash cold, Do not bleach" class="w-full"></textarea>
    <label for="careInstructions">Care Instructions</label>
  </p-floatlabel>
</div>

<!-- Made By -->
<div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
  <p-floatlabel variant="on">
    <input pInputText [(ngModel)]="variant.madeBy" name="madeBy" id="madeBy"
      placeholder="e.g. Local Artisans" class="w-full" />
    <label for="madeBy">Made By</label>
  </p-floatlabel>
</div>

<!-- Size Recommendation -->
<div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
  <p-floatlabel variant="on">
    <input pInputText [(ngModel)]="variant.sizeRecommendation" name="sizeRecommendation"
      id="sizeRecommendation" placeholder="e.g. True to Size / Order One Size Up" class="w-full" />
    <label for="sizeRecommendation">Size Recommendation</label>
  </p-floatlabel>
</div>

<!-- Model Info -->
<div class="w-full sm:w-full lg:w-1/2 px-2 mb-4">
  <p-floatlabel variant="on">
    <textarea pInputTextarea [(ngModel)]="variant.modelInfo" name="modelInfo" id="modelInfo"
      rows="2" placeholder="e.g. Model is 5’7” and wearing size S" class="w-full"></textarea>
    <label for="modelInfo">Model Info</label>
  </p-floatlabel>
</div>



        <!-- rating -->
<div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4">
  <label for="rating" class="block mb-1 font-medium text-gray-700">Rating</label>
  <p-rating [(ngModel)]="variant.rating" name="rating" [stars]="5" inputId="rating"></p-rating>
  @if(!variant.rating){
    <small class="p-error text-red-800">Rating is required</small>
  }
</div>

        <!-- Featured Checkbox -->
        <div class="w-full sm:w-1/2 lg:w-1/4 px-2 mb-4 flex items-center">
          <p-checkbox [(ngModel)]="variant.isFeatured" name="Featured" binary="true" inputId="isFeatured"></p-checkbox>
          <label for="isFeatured" class="ml-2">Featured?</label>
        </div>
      </div>


      <!--Variant Description -->
      <div class="flex w-full ">
        <div class="basis-4/4 px-2">
          <p-floatlabel variant="on">
            <textarea pTextarea id="variantDscription" name="variantDscription" [(ngModel)]="variant.variantDscription"
              #variantDscription="ngModel" required [autoResize]="true" rows="3" class="w-full"></textarea>
            <label for="variantDscription">Description of the variant</label>
          </p-floatlabel>
          @if(variantDscription.invalid && variantDscription.touched){<small class="p-error text-red-800">variant description is
            required</small>}
        </div>
      </div>
 </div>
         </div>
</p-fluid>
<!-- Add Size Header + Button (on same line) -->
 <p-fluid class="flex mt-5">
        <div class="card flex flex-col gap-6 w-full">
            <div class="flex justify-between items-center flex-wrap mt-2">
                    <h6 class="mb-0">Add the size details</h6>
                    <p-button label="Add Size" icon="pi pi-plus" severity="warn" raised (click)="addSize()"
                        pTooltip="Add new size" tooltipPosition="left">
                    </p-button>
                </div>

            <!-- Size Table -->
            <p-table [value]="variant.sizes" dataKey="sku" editMode="row" [responsiveLayout]="'scroll'" class="w-full">

                <ng-template pTemplate="header">
                    <tr>
                        <th>Size</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Discount %</th>
                        <th>SKU</th>
                        <th>HSN</th>
                        <th>Actions</th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-size let-editing="editing">
                    <tr [pEditableRow]="size">
                        <!-- Size -->
                        <td pEditableColumn>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input pInputText [(ngModel)]="size.size" />
                                </ng-template>
                                <ng-template pTemplate="output">{{ size.size }}</ng-template>
                            </p-cellEditor>
                        </td>

                        <!-- Price -->
                        <td pEditableColumn>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-inputnumber [(ngModel)]="size.price" mode="decimal" />
                                </ng-template>
                                <ng-template pTemplate="output">{{ size.price }}</ng-template>
                            </p-cellEditor>
                        </td>

                        <!-- Quantity -->
                        <td pEditableColumn>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-inputnumber [(ngModel)]="size.quantity" />
                                </ng-template>
                                <ng-template pTemplate="output">{{ size.quantity }}</ng-template>
                            </p-cellEditor>
                        </td>

                        <!-- Discount -->
                        <td pEditableColumn>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-inputnumber [(ngModel)]="size.discountPercentage" suffix="%" />
                                </ng-template>
                                <ng-template pTemplate="output">{{ size.discountPercentage }}%</ng-template>
                            </p-cellEditor>
                        </td>

                        <!-- SKU -->
                        <td pEditableColumn>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input pInputText [(ngModel)]="size.sku" />
                                </ng-template>
                                <ng-template pTemplate="output">{{ size.sku }}</ng-template>
                            </p-cellEditor>
                        </td>

                        <!-- HSN -->
                        <td pEditableColumn>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input pInputText [(ngModel)]="size.hsnCode" />
                                </ng-template>
                                <ng-template pTemplate="output">{{ size.hsnCode }}</ng-template>
                            </p-cellEditor>
                        </td>

                        <!-- Actions -->
                        <td>
                            <div class="flex gap-2">
                                @if(!editing){
                                <p-button icon="pi pi-pencil" severity="info" outlined rounded raised
                                    pInitEditableRow></p-button>
                                }
                                @if(editing){
                                <p-button icon="pi pi-check" severity="success" outlined rounded raised
                                    pSaveEditableRow></p-button>
                                <p-button icon="pi pi-times" severity="secondary" outlined rounded raised
                                    pCancelEditableRow></p-button>
                                }
                                <p-button icon="pi pi-trash" severity="danger" outlined rounded raised
                                    (click)="removeSize(size)"></p-button>
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
</div>
</p-fluid>

<p-fluid class="w-full mt-4">
    <div class="w-full mt-5">
        <div class="card flex flex-col gap-4 p-4">
            <h5 class="text-lg font-semibold">Upload Product Images</h5>

            @if(showeErrorSuggestionFile){
            <span class="p-error text-red-800 text-sm">
                (NOTE : All fields are mandatory to be filled)
            </span>
            }

            <p-fileupload name="files[]" (onSelect)="onFileSelect($event)" (onRemove)="onFileRemove($event)"
                (onClear)="onClearFiles()" [multiple]="true" accept="image/*" maxFileSize="1000000" mode="advanced"
                styleClass="w-full" chooseLabel="Choose" uploadLabel="Upload" cancelLabel="Cancel">
                <ng-template #empty>
                    <div class="text-center text-gray-500">
                        Drag and drop files here to upload.
                    </div>
                </ng-template>
            </p-fileupload>
        </div>
    </div>
</p-fluid>

<p-fluid class="flex flex-col md:flex-row gap-6 mt-5">
    <div class="w-full md:w-1/2 flex ">
        <div class="card flex flex-col gap-4 p-4 justify-end">
            <p-button pTooltip="save" tooltipPosition="left" label="Save Variant" icon="pi pi-save" raised type="button"
                (click)="onSubmit(formRef)" severity="warn" size="large">
            </p-button>
        </div>
    </div>
</p-fluid>
}