<p-confirmDialog></p-confirmDialog>



<div class="card p-6 rounded-lg shadow-md bg-white max-w-5xl mx-auto mt-6">

  <!-- <div class="mb-4">
  <h3 class="text-lg font-semibold mb-2">Select Payment Method</h3>
  <div class="flex gap-4">
    <p-radioButton name="payment" value="Prepaid"  [(ngModel)]="selectedPaymentMode" inputId="Prepaid"></p-radioButton>
    <label for="Prepaid">Prepaid</label>

    <p-radioButton name="payment" value="COD" disabled="true" [(ngModel)]="selectedPaymentMode" inputId="cod"></p-radioButton>
    <label for="cod">Cash on Delivery</label>
  </div>
</div> -->

  <!-- Heading -->
  <h2 class="text-2xl font-semibold text-green-600 mb-6 flex items-center gap-2 ">
    <i class="pi pi-map-marker text-lg"></i> Select Address
  </h2>

  <!-- Address Selection -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">


    <div *ngFor="let address of addresses" class="relative">
    <!-- Hidden radio for selection -->
    <input 
      type="radio"
      name="selectedAddress"
      [value]="address.id"
      [checked]="selectedAddressId === address.id"
      (change)="selectAddress(address.id)"
      class="hidden peer"
      id="address-{{ address.id }}" />

    <!-- Address Card -->
    <label 
      for="address-{{ address.id }}"
      class="block p-4 border rounded-lg cursor-pointer transition-all bg-grey-50 peer-checked:border-green-500 peer-checked:shadow-lg peer-checked:ring-2 peer-checked:ring-green-200 hover:shadow-md">

      <!-- Checkmark circle -->
      <div class="absolute top-3 right-3 w-6 h-6 rounded-full border-2 border-green-400 flex items-center justify-center transition-all"
           [ngClass]="{'bg-green-500 text-white': selectedAddressId === address.id}">
        <i *ngIf="selectedAddressId === address.id" class="pi pi-check text-xs"></i>
      </div>
<p class="font-semibold text-gray-800">{{ address.name }}</p>
      <p class="font-semibold text-gray-800">{{ address.address }}</p>
      <p class="text-sm text-gray-700">{{ address.city }}, {{ address.state }} - {{ address.pinCode }}</p>
      <p class="text-sm text-gray-700">{{ address.country }}</p>
      <p class="text-sm text-gray-700"><i class="pi pi-phone mr-1"></i> {{ address.phoneNumber }}</p>

      <!-- Buttons -->
      <div class="flex justify mt-3 gap-2">
        <p-button icon="pi pi-pencil" label="Edit" outlined raised severity="contrast" (click)="editAddress(address)"></p-button>
        <p-button icon="pi pi-trash"  label="Delete" outlined raised severity="contrast" (click)="deleteAddress(address.id)"></p-button>
      </div>
    </label>
  </div>
  </div>

  <!-- Add New Address Button -->
  <div class="text-right mb-4">
    <p-button (click)="showAddAddressDialog = true" icon="pi pi-plus" label="Add New Address" outlined
      severity="primary">
    </p-button>
  </div>

  <!-- Add Address Modal Dialog -->
  <p-dialog header="Add New Address" [(visible)]="showAddAddressDialog" [modal]="true"
    [style]="{ width: '600px', maxHeight: '90vh', overflowY: 'auto' }" [dismissableMask]="true" [closeOnEscape]="true"
    [breakpoints]="{ '768px': '90vw' }" responsive="true" class="p-fluid" (onHide)="addressForm.reset()">

    <form [formGroup]="addressForm" (ngSubmit)="submitNewAddress()" class="mt-5 grid grid-cols-1 md:grid-cols-2 gap-4">

      <p-floatlabel variant="on">
        <input pInputText formControlName="name" id="name"
          [ngClass]="{'p-filled': addressForm.get('name')?.value}"
          class="w-full h-10 border border-gray-300 rounded-md focus:ring-1 focus:ring-orange-500 focus:outline-none" />
        <label for="name">Name</label>
      </p-floatlabel>

      <p-floatlabel variant="on">
        <input pInputText formControlName="address" id="shippingAddress"
          [ngClass]="{'p-filled': addressForm.get('address')?.value}"
          class="w-full h-10 border border-gray-300 rounded-md focus:ring-1 focus:ring-orange-500 focus:outline-none" />
        <label for="shippingAddress">D/no | House name / Flat / Landmark</label>
      </p-floatlabel>

      <p-floatlabel variant="on">
  <input pInputText
         formControlName="phoneNumber"
         id="phoneNumber"
         maxlength="10"
         (input)="onPhoneInput($event)"
         [ngClass]="{'p-filled': addressForm.get('phoneNumber')?.value}"
         class="w-full h-10 border border-gray-300 rounded-md focus:ring-1 focus:ring-orange-500 focus:outline-none"
         inputmode="numeric"
         pattern="[0-9]*"
         placeholder="Enter 10-digit phone number" />
  <label for="phoneNumber">Phone Number of Receiver</label>
</p-floatlabel>


      <p-floatlabel variant="on">
        <input pInputText formControlName="country" id="country"
          [ngClass]="{'p-filled': addressForm.get('country')?.value}"
          class="w-full h-10 border border-gray-300 rounded-md focus:ring-1 focus:ring-orange-500 focus:outline-none" />
        <label for="country">Country</label>
      </p-floatlabel>

      <p-floatlabel variant="on">
        <input pInputText formControlName="state" id="state" [ngClass]="{'p-filled': addressForm.get('state')?.value}"
          class="w-full h-10 border border-gray-300 rounded-md focus:ring-1 focus:ring-orange-500 focus:outline-none" />
        <label for="state">State</label>
      </p-floatlabel>

      <p-floatlabel variant="on">
        <input pInputText formControlName="pinCode" id="pinCode"
          [ngClass]="{'p-filled': addressForm.get('pinCode')?.value}"
          class="w-full h-10  border border-gray-300 rounded-md focus:ring-1 focus:ring-orange-500 focus:outline-none" />
        <label for="pinCode">Pin Code</label>
      </p-floatlabel>

      <p-floatlabel variant="on">
        <input pInputText formControlName="city" id="city" [ngClass]="{'p-filled': addressForm.get('city')?.value}"
          class="w-full h-10 border border-gray-300 rounded-md focus:ring-2 focus:ring-orange-500 focus:outline-none" />
        <label for="city">City</label>
      </p-floatlabel>

      <div class="col-span-full text-right mt-4">
        <p-button label="Save Address" type="submit" icon="pi pi-save" [disabled]="addressForm.invalid"
          severity="success">
        </p-button>
      </div>
    </form>
  </p-dialog>

  <!-- Next Button -->
  <div class="text-right mt-4">
    <p-button  label="Place Order" styleClass="w-full sm:w-auto" size="large" icon="pi pi-arrow-right" severity="contrast" (click)="placeOrder()">
    </p-button>
  </div>
</div>